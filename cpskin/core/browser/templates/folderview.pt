<html xmlns="http://www.w3.org/1999/xhtml"
      xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="cpskin">

  <metal:javascript_head_slot fill-slot="javascript_head_slot"
                              tal:define="hasFlexSlider view/hasFlexSlider;
                                          alaune exists: context/a-la-une"
                              tal:condition="python: hasFlexSlider and alaune">
      <script type="text/javascript"
              charset="utf-8"
              src=""
              tal:attributes="src string:${context/@@plone_portal_state/portal_url}/++resource++jquery.flexslider/javascript/jquery.flexslider-min.js"></script>
  </metal:javascript_head_slot>

  <body>
    <div metal:fill-slot="main"
         tal:define="member context/@@plone_portal_state/member;
                     contents view/getContents">
      <metal:main-macro define-macro="main">
        <div id="accueil">

            <tal:bcl tal:repeat="content contents">

                <div id="flex"
                     tal:condition="python: content.id == 'a-la-une' and view.hasFlexSlider()">

                    <div class="flex-container"
                         tal:define="context nocall:context/a-la-une/a-la-une;
                                     here nocall:context/a-la-une/a-la-une">
                      <metal:block use-macro="context/@@slider_view/macros/content-core" />
                    </div>

                </div>

                <div class=""
                     tal:condition="python: content.portal_type == 'Collection' and content.id != 'a-la-une'"
                     tal:attributes="class string:bloc-${repeat/content/number} bloc-collection">
                    <a href=""
                       class="titre"
                       tal:attributes="href string:${content/absolute_url}">
                      <h2 tal:content="content/Title"></h2>
                    </a>
                    <a class="bloc-rss"
                       href=""
                       tal:attributes="href string:${content/absolute_url}/RSS">
                      <img src="++resource++cpskin.core.images/rss-accueil.gif"
                           alt="Flux RSS"
                           i18n:attributes="alt flux_rss" />
                    </a>
                    <ul class="bloc-items">
                      <li tal:repeat="result content/results"
                          class="bloc-item"
                          colspan="2">
                        <a href=""
                           tal:attributes="href result/absolute_url">

                          <tal:leadImage tal:condition="nocall:item/hasContentLeadImage|nothing">
                            <img class="myimageleft"
                                 tal:condition="item/hasContentLeadImage"
                                 src="#"
                                 alt=""
                                 tal:attributes="title item/Description; src python: item.getURL() + '/leadImage_thumb'" />
                          </tal:leadImage>

                          <tal:contentImage tal:condition="nocall:item/getImage|nothing">
                            <span tal:replace="structure python: result.tag(scale='thumb', css_class=imageClass)"
                                  tal:define="oddRow repeat/item/odd; imageClass python: oddRow and 'myimageleft' or 'myimageleft'"
                                  tal:condition="result/getImage" />
                          </tal:contentImage>

                          <h3 tal:content="result/Title"></h3>
                        </a>

                        <span class="documentByLine"
                              tal:condition="python: result.portal_type == 'Event'">
                          <tal:one_day condition="python: here.toLocalizedTime(result.start, long_format=0) == here.toLocalizedTime(result.end, long_format=0)">
                          <span i18n:translate="evenement_le">le</span>
                          <span tal:content="python: here.toLocalizedTime(result.start, long_format=0)" />
                          <tal:withHours condition="python: here.toLocalizedTime(result.start, long_format=1)[11:] != '00:00' or here.toLocalizedTime(result.end, long_format=1)[11:] != '00:00'">
                          <span i18n:translate="evenement_de">de</span>
                          <span tal:content="python: here.toLocalizedTime(result.start, long_format=1)[11:]" />
                          <span i18n:translate="evenement_a">à</span>
                          <span tal:content="python: here.toLocalizedTime(result.end, long_format=1)[11:]" /></tal:withHours></tal:one_day>
                          <tal:more_days condition="python: here.toLocalizedTime(result.start, long_format=0) != here.toLocalizedTime(result.end, long_format=0)">
                          <span i18n:translate="evenement_du">du</span>
                          <span tal:content="python: here.toLocalizedTime(result.start, long_format=0)" />
                          <span i18n:translate="evenement_au">au</span>
                          <span tal:content="python: here.toLocalizedTime(result.end, long_format=0)" /></tal:more_days>
                        </span>

                        <span class="documentByLine"
                              tal:condition="python: result.portal_type != 'Event' and view.hasEffectiveDate(result)">
                          <span i18n:translate="evenement_le">le</span>
                          <span tal:content="python: here.toLocalizedTime(result.effective, long_format=0)" />
                          <span i18n:translate="evenement_a">à</span>
                          <span tal:content="python: here.toLocalizedTime(result.effective, long_format=1)[11:]" />
                        </span>

                        <p tal:content="result/Description"></p>
                      </li>
                    </ul>
                    <a href=""
                       class="voir-tout"
                       tal:attributes="href string:${content/absolute_url}">
                       <span i18n:translate="voir_lensemble_des">Voir l'ensemble des </span> <span tal:replace="content/Title" />
                    </a>
                </div>

                <div class=""
                     tal:condition="python: content.portal_type == 'Document'"
                     tal:attributes="class string:bloc-${repeat/content/number} bloc-document">

                    <p tal:condition="python: member.has_role('Manager')">
                      <a href=""
                         tal:attributes="href string:${content/absolute_url}/edit"
                         i18n:translate="modifier_zone_statique">[Modifier la zone statique]</a>
                    </p>
                    <p tal:replace="structure content/getText" />

                </div>

            </tal:bcl>

            <div class="visualClear"></div>
        </div>
      </metal:main-macro>
    </div>
  </body>
</html>

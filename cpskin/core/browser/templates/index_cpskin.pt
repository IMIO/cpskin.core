<html xmlns="http://www.w3.org/1999/xhtml"
      xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">
  <!-- limitNumber est le nombre d'elements a afficher dans la page-->
  <body>
    <div metal:fill-slot="main"
         tal:define="limitNumberActus python: 7;
                                            limitNumberEvents python: 7;
                                            member context/@@plone_portal_state/member;
                                            navigation_root_path context/@@plone_portal_state/navigation_root_path;
                                            news_collection python: view.getActualites(navigation_root_path);
                                            events_collection python: view.getEvenements(navigation_root_path);
    ">
      <metal:main-macro define-macro="main">
        <div id="accueil">
          <table>
            <tr tal:condition="python: hasattr(context,'front-page')">
              <td colspan="5"
                  id="blocune">
                <p tal:condition="python: member.has_role('Manager')">
                  <a href="front-page/edit">[Modifier la zone statique]</a>
                </p>
                <p tal:replace="structure view/getFrontPageText" />
              </td>
            </tr>
            <tr>
              <td colspan="3"
                  height="8px"></td>
            </tr>
            <tr>
              <td valign="top"
                  width="50%">
                <div id="bloc1">
                  <table width="100%"
                         id="bloctable">
                    <tr>
                      <td id="bloc1a">
                        <a href="actualites"
                           i18n:translate="">News</a>
                      </td>
                      <td id="bloc1a"
                          class="imagebloc1"
                          align="right">
                      <a href="actualites/aggregator/RSS">
                        <img src="rss-accueil.png"
                             alt="Flux RSS des dernières actualités" />
                      </a>&#160;</td>
                    </tr>
                  </table>
                </div>
                <div id="bloc12">
                  <tal:infos_comm tal:define="batch python: news_collection.getObject().results(batch=False)[:limitNumberActus]">

                    <table width="100%"
                           tal:condition="batch">
                      <tal:loop repeat="item batch">
                        <tr>
                          <td id="bloc1b"
                              colspan="2"
                              tal:define="object item/getObject">
                            <br />
                            <a href=""
                               tal:attributes="href python: object.absolute_url()">
                              <div tal:replace="structure python: object.tag(scale='tile', css_class=imageClass)"
                                   tal:define="oddRow repeat/item/odd; imageClass python: oddRow and 'myimageleft' or 'myimageleft'"
                                   tal:condition="object/getImage" />
                              <span tal:content="python: object.Title()" />
                            </a>
                            <br />
                            <span tal:content="python: object.Description()" />
                            <br />
                            <!--div class="home-actu-date" i18n:translate="">Publi&eacute; le <span tal:content="python: here.toLocalizedTime(object.effective(), long_format=0)" /></div-->
                          </td>
                        </tr>
                      </tal:loop>
                    </table>
                  </tal:infos_comm>
                </div>
              </td>
              <td width="2%"
                  class="ligneverticale"></td>
              <td valign="top"
                  width="48%">
                <div id="bloc2">
                  <table id="bloctable"
                         width="100%">
                    <tr>
                      <td id="bloc1a">
                        <a href="evenements"
                           i18n:translate="">Events</a>
                      </td>
                      <td id="bloc1a"
                          class="imagebloc2"
                          align="right">
                      <a href="evenements/aggregator/RSS">
                        <img src="rss-accueil.png"
                             alt="Flux RSS des derniers évènements" />
                      </a>&#160;</td>
                    </tr>
                  </table>
                </div>
                <div id="bloc22">
                  <tal:infos_comm tal:define="batch python: events_collection.getObject().results(batch=False)[:limitNumberEvents]">

                    <table width="100%"
                           tal:condition="batch">
                      <tal:loop repeat="item batch">
                        <tr>
                          <td id="bloc1b"
                              colspan="2"
                              tal:define="object item/getObject">
                            <a href=""
                               tal:attributes="href python: object.absolute_url()">
                              <br />
                              <span class="link-event"
                                    tal:content="python: object.Title()" />
                            </a>
                            <br />
                            <span class="documentByLine">
                              <tal:one_day condition="python: here.toLocalizedTime(object.start(), long_format=0) == here.toLocalizedTime(object.end(), long_format=0)">
                              le 
                              <span tal:content="python: here.toLocalizedTime(object.start(), long_format=0)" />
                              <tal:withHours condition="python: here.toLocalizedTime(object.start(), long_format=1)[11:] != '00:00' or here.toLocalizedTime(object.end(), long_format=1)[11:] != '00:00'">
                              de 
                              <span tal:content="python: here.toLocalizedTime(object.start(), long_format=1)[11:]" />à
                              <span tal:content="python: here.toLocalizedTime(object.end(), long_format=1)[11:]" /></tal:withHours></tal:one_day>
                              <tal:more_days condition="python: here.toLocalizedTime(object.start(), long_format=0) != here.toLocalizedTime(object.end(), long_format=0)">
                              du 
                              <span tal:content="python: here.toLocalizedTime(object.start(), long_format=0)" />au
                              <span tal:content="python: here.toLocalizedTime(object.end(), long_format=0)" /></tal:more_days>
                            </span>
                            <br />
                            <tal:contentImage tal:condition="nocall:item/hasContentLeadImage|nothing">

                              <img class="myimageleft"
                                   tal:condition="item/hasContentLeadImage"
                                   src="#"
                                   tal:attributes="title item/Description; src python: item.getURL() + '/leadImage_thumb'" />
                            </tal:contentImage>
                            <span tal:content="python: object.Description()" />
                            <br />
                          </td>
                        </tr>
                      </tal:loop>
                    </table>
                  </tal:infos_comm>
                </div>
              </td>
            </tr>
            <tr>
              <td colspan="3"></td>
            </tr>
            <tr>
              <td colspan="3"></td>
            </tr>
          </table>
        </div>
      </metal:main-macro>
    </div>
  </body>
</html>
